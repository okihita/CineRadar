name: Test Firestore Upload

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: pip install google-cloud-firestore
      
      - name: Create minimal test data
        run: |
          mkdir -p data
          cat > data/movies_2025-12-14.json << 'TESTDATA'
          {
            "scraped_at": "2025-12-14 06:00:00",
            "date": "2025-12-14",
            "movies": [{
              "id": "test123",
              "title": "TEST MOVIE",
              "schedules": {
                "JAKARTA": [{
                  "theatre_id": "test_theatre_001",
                  "theatre_name": "TEST CINEMA",
                  "merchant": "XXI",
                  "address": "Test Address",
                  "rooms": [{"category": "REGULAR 2D"}]
                }]
              }
            }]
          }
          TESTDATA
      
      - name: Test Firestore upload
        run: python populate_firestore.py
        env:
          FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
